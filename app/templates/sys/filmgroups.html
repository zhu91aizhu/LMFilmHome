{% extends "sys/index.html" %}

{% block head %}
    {{ super() }}

    <script>
        /**
         * 删除电影组回调
         * @param data 回调数据
         */
        function deleteFilmGroupCallback(data) {
            var succ = data == "success" ? true : false;

            if (succ) {
                $("#alert-confirm .am-modal-bd").html("删除成功");
            }
            else {
                $("#alert-confirm .am-modal-bd").html("删除失败");
            }

            $('#alert-confirm').modal({
                relatedTarget: this,
                onConfirm: function (options) {
                    if (succ) {
                        location = "/sys/filmgroup";
                    }
                },
                closeViaDimmer: false
            });
        }

        /**
         * 显示确认提示框
         * @param confirmText 显示文本
         * @param url 请求地址
         * @param type 请求方法
         * @param data 请求数据
         */
        function showConfirmModal(confirmText, url, type, data) {
            $("#delete-confirm .am-modal-bd").html(confirmText);

            $('#delete-confirm').modal({
                relatedTarget: this,
                onConfirm: function (options) {
                    $.ajax({
                        url: url,
                        type: type,
                        data: data,
                        dataType: "text",
                        success: deleteFilmGroupCallback
                    });
                },
                closeViaDimmer: false
            });
        }

        function deleteFilmGroup() {
            var $this = $(this);
            var id = $this.attr("data-id");

            showConfirmModal("确定要删除这条电影组记录吗？", "/sys/filmgroup/" + id, "DELETE");
        }

        function multiDeleteFilmGroup() {
            var ids = [];
            $("input:checked").each(function () {
                ids.push($(this).attr("data-id"));
            });

            var param = {
                "ids": ids.join()
            };

            showConfirmModal("确定要删除选中的电影组记录吗？", "/sys/filmgroup", "POST", param);
        }

        function modifyFilmGroup() {
            var $this = $(this);
            var id = $this.attr("data-id");
            location = "/sys/filmgroup/" + id + "/modify";
        }

        function allSelected() {
            var status = $(this).is(":checked");
            $("input[name=check-item]").each(function() {
                if (status) {
                    $(this).prop("checked", true);
                }
                else {
                    $(this).prop("checked", false);
                }
            })
        }

        $(document).ready(function () {
            $("#btn-add-filmgroup").on("click", function () {
                location = "/sys/filmgroup/new";
            });

            $("input[name=btn-delete]").on("click", deleteFilmGroup);
            $("input[name=btn-modify]").on("click", modifyFilmGroup);
            $("#btn-multi-del-filmgroup").on("click", multiDeleteFilmGroup);
            $("#cb-all-selected").on("click", allSelected);
            $("input[name=check-item]").on("click", function () {
                if ($("input[name=check-item]:checked").length == $("input[name=check-item]").length) {
                    $("#cb-all-selected").prop("checked", true);
                }
                else {
                    $("#cb-all-selected").prop("checked", false);
                }
            });
        });
    </script>

    <style>
        th {
            text-align: center;
        }

        tr {
            text-align: center;
        }
    </style>
{% endblock head %}

{% block content %}
    <div class="admin-content-body">
        <div class="am-cf am-padding am-padding-bottom-0">
            <div class="am-fl am-cf"><strong class="am-text-primary am-text-lg">内容设置</strong> /
                <small>电影组</small>
            </div>
        </div>

        <hr/>

        <div class="am-g">
            <div class="am-u-sm-12">
                <div class="am-form-group">
                    <input type="button" id="btn-add-filmgroup" class="am-btn am-btn-success am-radius" value="添加"/>
                    <input type="button" id="btn-multi-del-filmgroup" class="am-btn am-btn-warning am-radius" value="删除"/>
                </div>

                <table class="am-table am-table-bordered am-table-radius am-table-striped am-table-hover">
                    <thead>
                    <tr>
                        <th style="width: 5%;">
                            <input type="checkbox" id="cb-all-selected" class=".am-checkbox"/>
                        </th>
                        <th>电影组名称</th>
                        <th>电影组简介</th>
                        <th>内容数量</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for fg in filmgroups %}
                        <tr>
                            <td><input type="checkbox" name="check-item" data-id="{{ fg.id }}" /></td>
                            <td>{{ fg.name }}</td>
                            <td>{{ fg.intro|short_intro }}</td>
                            <td>{{ fg.content_count }}</td>
                            <td>
                                <input type="button" name="btn-modify" data-id="{{ fg.id }}"
                                       class="am-btn am-btn-secondary am-radius am-btn-sm"
                                       value="修改"/>
                                <input type="button" name="btn-delete" data-id="{{ fg.id }}"
                                       class="am-btn am-btn-warning am-radius am-btn-sm"
                                       value="删除"/>
                                <input type="button" name="btn-list" data-id="{{ fg.id }}"
                                       class="am-btn am-btn-primary am-radius am-btn-sm"
                                       value="电影列表"/>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="am-modal am-modal-alert" tabindex="-1" id="alert-confirm">
        <div class="am-modal-dialog">
            <div class="am-modal-hd">提示</div>
            <div class="am-modal-bd">
            </div>
            <div class="am-modal-footer">
                <span class="am-modal-btn" data-am-modal-confirm>确定</span>
            </div>
        </div>
    </div>

    <div class="am-modal am-modal-confirm" tabindex="-1" id="delete-confirm">
        <div class="am-modal-dialog">
            <div class="am-modal-hd">提示</div>
            <div class="am-modal-bd"></div>
            <div class="am-modal-footer">
                <span class="am-modal-btn" data-am-modal-cancel>取消</span>
                <span class="am-modal-btn" data-am-modal-confirm>确定</span>
            </div>
        </div>
    </div>
{% endblock %}